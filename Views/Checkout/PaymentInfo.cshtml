
@{
    ViewBag.Title = "PaymentInfo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="checkout-page">
    <div class="checkout-container">
        <!-- Progress Bar -->
        <div class="checkout-progress">
            <div class="progress-step completed">
                <div class="step-number">✓</div>
                <div class="step-label">Shipping</div>
            </div>
            <div class="progress-step active">
                <div class="step-number">2</div>
                <div class="step-label">Payment</div>
            </div>
            <div class="progress-step">
                <div class="step-number">3</div>
                <div class="step-label">Review</div>
            </div>
            <div class="progress-step">
                <div class="step-number">4</div>
                <div class="step-label">Complete</div>
            </div>
        </div>

        <!-- Checkout Header -->
        <div class="checkout-header">
            <h1>Payment Method</h1>
            <p>Choose your preferred payment option</p>
        </div>

        <!-- Checkout Form -->
        <div class="checkout-card">
            <form id="paymentForm" action="@Url.Action(" Step3", "Checkout" )" method="post">
                <!-- Payment Methods -->
                <div class="form-section">
                    <h2>Select Payment Method</h2>
                    <div class="payment-methods">
                        <label class="payment-method selected" data-method="credit-card">
                            <input type="radio" name="paymentMethod" value="credit-card" checked style="display: none;">
                            <div class="payment-icon">💳</div>
                            <div class="payment-details">
                                <h4>Credit/Debit Card</h4>
                                <p>Visa, Mastercard, American Express</p>
                            </div>
                        </label>

                        <label class="payment-method" data-method="paypal">
                            <input type="radio" name="paymentMethod" value="paypal" style="display: none;">
                            <div class="payment-icon">🔵</div>
                            <div class="payment-details">
                                <h4>PayPal</h4>
                                <p>Fast and secure payment</p>
                            </div>
                        </label>

                        <label class="payment-method" data-method="apple-pay">
                            <input type="radio" name="paymentMethod" value="apple-pay" style="display: none;">
                            <div class="payment-icon">🍎</div>
                            <div class="payment-details">
                                <h4>Apple Pay</h4>
                                <p>Pay with your Apple device</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Credit Card Form (shown by default) -->
                <div id="creditCardForm" class="form-section">
                    <h2>Card Details</h2>
                    <div class="form-group">
                        <label for="cardNumber">Card Number *</label>
                        <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date *</label>
                            <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" maxlength="5" required>
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV *</label>
                            <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="4" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cardName">Name on Card *</label>
                        <input type="text" id="cardName" name="cardName" placeholder="Jane Smith" required>
                    </div>
                </div>

                <!-- PayPal Form (hidden by default) -->
                <div id="paypalForm" class="form-section" style="display: none;">
                    <div class="payment-method-info">
                        <p>You will be redirected to PayPal to complete your payment after review.</p>
                    </div>
                </div>

                <!-- Apple Pay Form (hidden by default) -->
                <div id="applePayForm" class="form-section" style="display: none;">
                    <div class="payment-method-info">
                        <p>Apple Pay will be available on the next step after review.</p>
                    </div>
                </div>

                <!-- Billing Address -->
                <div class="form-section">
                    <h2>Billing Address</h2>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="sameAsShipping" checked>
                            Same as shipping address
                        </label>
                    </div>

                    <div id="billingAddressForm" style="display: none;">
                        <div class="form-group">
                            <label for="billingAddress">Address *</label>
                            <input type="text" id="billingAddress" name="billingAddress">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="billingCity">City *</label>
                                <input type="text" id="billingCity" name="billingCity">
                            </div>
                            <div class="form-group">
                                <label for="billingState">State *</label>
                                <input type="text" id="billingState" name="billingState">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="billingZip">ZIP Code *</label>
                                <input type="text" id="billingZip" name="billingZip">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="checkout-navigation">
                    <a href="@Url.Action(" Step1", "Checkout" )" class="nav-btn back">← Back to Shipping</a>
                    <button type="submit" class="nav-btn continue">Continue to Review →</button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
    // Payment method selection
    const paymentMethods = document.querySelectorAll('.payment-method');
    paymentMethods.forEach(method => {
        method.addEventListener('click', function() {
            paymentMethods.forEach(m => m.classList.remove('selected'));
            this.classList.add('selected');

            // Get selected method
            const methodType = this.dataset.method;
            const radioInput = this.querySelector('input[type="radio"]');
            radioInput.checked = true;

            // Show appropriate form
            document.getElementById('creditCardForm').style.display = methodType === 'credit-card' ? 'block' : 'none';
            document.getElementById('paypalForm').style.display = methodType === 'paypal' ? 'block' : 'none';
            document.getElementById('applePayForm').style.display = methodType === 'apple-pay' ? 'block' : 'none';
        });
    });

    // Billing address toggle
    document.getElementById('sameAsShipping').addEventListener('change', function() {
        const billingForm = document.getElementById('billingAddressForm');
        billingForm.style.display = this.checked ? 'none' : 'block';

        // Clear or set required attributes
        const billingInputs = billingForm.querySelectorAll('input');
        billingInputs.forEach(input => {
            input.required = !this.checked;
        });
    });

    // Card number formatting
    document.getElementById('cardNumber').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
        let formatted = value.replace(/(\d{4})/g, '$1 ').trim();
        e.target.value = formatted.substring(0, 19);
    });

    // Expiry date formatting
    document.getElementById('expiryDate').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        e.target.value = value.substring(0, 5);
    });

    // CVV formatting
    document.getElementById('cvv').addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
    });
</script>
