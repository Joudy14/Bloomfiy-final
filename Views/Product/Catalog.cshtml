@model IEnumerable<Bloomfiy_final.Models.Product>

@{
    ViewBag.Title = "Shop | Bloomfiy";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var categories = ViewBag.Categories as List<Bloomfiy_final.Models.Categories>;
    var colors = ViewBag.Colors as List<Bloomfiy_final.Models.Color>;
}


<section class="catalog-page">

    <!-- HEADER -->
    <div class="catalog-header">
        <h1>Our Flowers</h1>
        <p>Fresh, elegant blooms crafted with love</p>
    </div>

    <div class="catalog-layout">

        <!-- FILTERS -->
        <aside class="catalog-filters">

            <div class="filter-group">
                <h3>Categories</h3>
                @foreach (var cat in categories)
                {
                    <label class="filter-option">
                        <input type="checkbox"
                               class="filter-category"
                               value="@cat.CategoryId">
                        @cat.CategoryName
                    </label>
                }
            </div>

            <div class="filter-group">
                <h3>Colors</h3>
                <div class="color-filters">
                    @foreach (var color in colors)
                    {
                        <button type="button"
                                class="color-filter"
                                data-color="@color.ColorId"
                                title="@color.ColorName"
                                style="background:@color.ColorCode">
                        </button>
                    }
                </div>

            </div>

            <div class="filter-group">
                <h3>Max Price</h3>
                <input type="range" id="priceFilter" min="0" max="200" value="200">
                <span class="price-label">$<span id="priceValue">200</span></span>
            </div>

            <button id="clearFilters" class="clear-btn">Clear Filters</button>

        </aside>

        <!-- PRODUCTS -->
        <main class="catalog-products">

            <!-- SORT -->
            <div class="catalog-sort">
                <select id="sortSelect">
                    <option value="">Sort by</option>
                    <option value="name-asc">Name A–Z</option>
                    <option value="price-asc">Price Low → High</option>
                    <option value="price-desc">Price High → Low</option>
                </select>
            </div>

            <div class="products-grid" id="productsGrid">
                @foreach (var product in Model)
                {
                    <div class="product-card"
                         data-product-id="@product.ProductId"
                         data-category="@product.CategoryId"
                         data-price="@product.BasePrice"
                         data-colors="@string.Join(",", product.ProductColors.Select(pc => pc.ColorId))">


                        <div class="product-image">
                            <img src="@product.DefaultImageUrl" alt="@product.Name">
                            @{
                                var wishlistIds = ViewBag.WishlistIds as List<int> ?? new List<int>();
                            }

                        <form class="wishlist-form">
                            <input type="hidden" name="id" value="@product.ProductId" />
                            <input type="hidden" name="name" value="@product.Name" />
                            <input type="hidden" name="price" value="@product.BasePrice" />
                            <input type="hidden" name="imageUrl" value="@product.DefaultImageUrl" />

                            <button type="submit"
                                    class="wishlist-btn @(wishlistIds.Contains(product.ProductId) ? "active" : "")">
                                ♥
                            </button>

                        </form>

                        </div>

                        <div class="product-info">
                            <h3>@product.Name</h3>

                            <p>
                                @(product.Description?.Length > 80
                                    ? product.Description.Substring(0, 80) + "..."
                                    : product.Description)
                            </p>

                            <div class="product-price">
                                From $@product.BasePrice
                            </div>

                            <a href="@Url.Action("Details", "Product", new { id = product.ProductId })"
                               class="view-btn">
                                View Details
                            </a>
                        </div>

                    </div>
                }
            </div>

        </main>

    </div>

</section>

@section Scripts {
    <script src="~/Scripts/catalog.js"></script>
}
